 <html lang="en"> 

<head>

    <title>MO COVID-19 Data By County</title>
	<meta charset="utf-8"/>
	 
    <!-- CSS Libraries -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.css" rel="stylesheet"
        integrity="sha256-aa0xaJgmK/X74WM224KMQeNQC2xYKwlAt08oZqjeF0E=" crossorigin="anonymous">

    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.11/dist/vue.min.js"
        integrity="sha256-ngFW3UnAN0Tnm76mDuu7uUtYEcG3G5H1+zioJw3t+68=" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
        integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous">
    </script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous">
    </script>
	<script src="https://cdn.jsdelivr.net/npm/moment@2.25.3/min/moment.min.js"
		integrity="sha256-C66CaAImteEKZPYvgng9j10J/45e9sAuZyfPYCwp4gE=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"
        integrity="sha256-R4pqcOYV8lt7snxMQO/HSbVCFRPMdrhAFMH+vr9giYI=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-colorschemes"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@0.5.7/chartjs-plugin-annotation.min.js"
        integrity="sha256-Olnajf3o9kfkFGloISwP1TslJiWUDd7IYmfC+GdCKd4=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
	
	<style>
		h2 {
			font-size: 1.5rem;
		}
	</style>
</head>

<body>

    <header>
        <div class="navbar navbar-dark bg-dark box-shadow">
            <div class="container d-flex justify-content-between">
                <h1>MO COVID-19 Data By County</h1>
            </div>
        </div>
    </header>

    <main role="main" class="container mt-4">
        <div class="row" id="covid-app">
			<div class="col-md-12">
				<div class="card mb-3">
					<h2 class="card-header collapsed" data-toggle="collapse" data-target="#counties"
						aria-expanded="true" aria-controls="browse-by-instructor" style="cursor: pointer">
						Counties
					</h2>
					<div class="collapse collapsed" id="counties">
						<div class="card-body">
							<ul class="collapsible-tree">
								<li v-for="county in counties" :key="county.name" style="list-style-type: none">
									<label>
										<input type="checkbox" v-model="county.selected" v-on:change="toggleCounty(county)"> 
										{{ county.name }}
									</label>
								</li>
							</ul>
						</div>
					</div>
				</div>
			</div>
        </div>

        <div class="row mb-4">
			<div class="col-md-6">
				<div class="card">
					<div class="card-body">
						<h2 class="card-title text-center">Total Cases</h2>
						<canvas id="cases" style="max-height: 500px; width: 100%"></canvas>
					</div>
				</div>
			</div>
			<div class="col-md-6">
				<div class="card">
					<div class="card-body">
						<h2 class="card-title text-center">New Cases</h2>
						<canvas id="new-cases" style="max-height: 500px; width: 100%"></canvas>
					</div>
				</div>
			</div>
        </div>
        <div class="row mb-4">
			<div class="col-md-6">
				<div class="card">
					<div class="card-body">
						<h2 class="card-title text-center">Active Cases (Estimate)<sup>1</sup></h2>
						<canvas id="active-cases" style="max-height: 500px; width: 100%"></canvas>
					</div>
				</div>
			</div>
        </div>

		<section id="notes">
			<h2>Notes</h2>
			<ol class="pl-3">
				<li>
					Active case data is not published at the county level.
					The number of active cases for a given day is estimated
					based on the total number of new cases in the last 14 days
					minus the total number of deaths in the last 14 days.
					14 days is based on 
					<a href="https://www.hopkinsmedicine.org/health/conditions-and-diseases/coronavirus/diagnosed-with-covid-19-what-to-expect">
					this Johns Hopkins Medicine article</a>.
				</li>
			</ol>
		</section>

    </main>

    <footer class="container">
        <p>Footer here</p>
    </footer>
	<script>
	COUNTIES = [
		"STATEWIDE", "Adair", "Andrew", "Atchison", "Audrain", "Barry", "Barton", "Bates",
		"Benton", "Bollinger", "Boone", "Buchanan", "Butler", "Caldwell", "Callaway", "Camden",
		"Cape Girardeau", "Carroll", "Carter", "Cass", "Cedar", "Chariton", "Christian", "Clark",
		"Clay", "Clinton", "Cole", "Cooper", "Crawford", "Dade", "Dallas", "Daviess", "DeKalb", "Dent",
		"Douglas", "Dunklin", "Franklin", "Gasconade", "Gentry", "Greene", "Grundy", "Harrison",
		"Henry", "Hickory", "Holt", "Howell", "Iron", "Jackson", "Jasper", "Jefferson", "Johnson",
		"Kansas City", "Knox", "Laclede", "Lafayette", "Lawrence", "Lewis", "Lincoln", "Linn",
		"Livingston", "Macon", "Madison", "Maries", "Marion", "McDonald", "Mercer", "Miller",
		"Mississippi", "Moniteau", "Monroe", "Montgomery", "Morgan", "New Madrid", "Newton", "Nodaway",
		"Oregon", "Osage", "Ozark", "Pemiscot", "Perry", "Pettis", "Phelps", "Pike", "Platte",
		"Polk", "Pulaski", "Putnam", "Ralls", "Randolph", "Ray", "Reynolds", "Ripley", "Saline",
		"Schuyler", "Scotland", "Scott", "Shannon", "Shelby", "St. Charles", "St. Clair", "St. Francois",
		"St. Louis City", "St. Louis", "Ste. Genevieve", "Stoddard", "Stone", "Sullivan", "Taney",
		"Texas", "Vernon", "Warren", "Washington", "Wayne", "Webster", "Worth", "Unassigned" 
	];
	
	<!-- Initialize charts -->
	var casesCtx = document.getElementById('cases').getContext('2d');
	var casesChart = new Chart(casesCtx, {
		type: "line",
		data: {},
		options: {
			scales: {
				xAxes: [{type: "time", time: {unit: "day"}}]
			},
			tooltips: {
				intersect: false,
				mode: "index"
			}
		} 
	});
		
	var newCasesCtx = document.getElementById('new-cases').getContext('2d');
	var newCasesChart = new Chart(newCasesCtx, {
		type: "line",
		data: {},
		options: {
			scales: {
				xAxes: [{type: "time", time: {unit: "day"}}]
			},
			tooltips: {
				intersect: false,
				mode: "index"
			}
		} 
	});

	var activeCasesCtx = document.getElementById('active-cases').getContext('2d');
	var activeCasesChart = new Chart(activeCasesCtx, {
		type: "line",
		data: {},
		options: {
			scales: {
				xAxes: [{type: "time", time: {unit: "day"}}]
			},
			tooltips: {
				intersect: false,
				mode: "index"
			}
		} 
	});

	<!-- Vue app -->
	const CovidApp = new Vue({
		el: '#covid-app',
		data: {
			counties: [],
		},
		methods: {
			toggleCounty: function(county) {
				if(county.selected && Object.keys(county.data).length === 0) {
					var that = this;
					Promise.resolve(this.getData(county)).then(function() {
						that.updateChartDataSets();
					});
				} else {
					this.updateChartDataSets();
				}
			},
			getData: function(county) {
				var encodedCountyName = encodeURIComponent(county.name);
				const url = "https://jswelker.github.io/mo-covid19-stats/data/" + encodedCountyName + ".json";
                return axios.get(url).then(function (response) {
                    county.data = response.data;
                });
			},
			updateChartDataSets: function() {
				var casesData = {datasets: []};
				var newCasesData = {datasets: []};
				var activeCasesData = {datasets: []};
				
				for(var county of this.counties) { 
					if (county.selected === false) {
						continue;
					}
					var casesDataset = {label: county.name, data: [], pointRadius: 0, lineTension: 0, fill: false};
					var newCasesDataset = {label: county.name, data: [], pointRadius: 0, lineTension: 0, fill: false};
					var activeCasesDataset = {label: county.name, data: [], pointRadius: 0, lineTension: 0, fill: false};
					for(var date in county.data) {
						casesDataset.data.push({x: date, y: county.data[date].cases});
						newCasesDataset.data.push({x: date, y: county.data[date].new_cases});
						activeCasesDataset.data.push({x: date, y: county.data[date].active_cases});
					}
					casesData.datasets.push(casesDataset);
					newCasesData.datasets.push(newCasesDataset);
					activeCasesData.datasets.push(activeCasesDataset);
				}
				
				this.updateChart(casesChart, casesData);
				this.updateChart(newCasesChart, newCasesData);
				this.updateChart(activeCasesChart, activeCasesData);
			},
			
			updateChart: function(chart, data) {
				chart.data = data;
				chart.update()
			},
		}
		
	});
	
	// Build the set of counties
	for(var county of COUNTIES) {
		CovidApp.counties.push({
			name: county,
			selected: false,
			data: {}
		});
	}
	
	// Activate the STATEWIDE "county" by default
	CovidApp.counties[0].selected = true;
	CovidApp.toggleCounty(CovidApp.counties[0]);
	</script>

</body>

</html>